
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>calc: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">go_homework/calc/calc.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package calc

import (
        "errors"
        "strconv"
        "strings"
)

type Calc struct{}

func (calc *Calc) Solve(input string) (result float64, err error) <span class="cov8" title="1">{
        // catching of errors
        defer func() </span><span class="cov8" title="1">{
                if r := recover(); r != nil </span><span class="cov8" title="1">{
                        err = errors.New(r.(string))
                        return
                }</span>
        }()

        // clear input
        <span class="cov8" title="1">input = strings.Replace(input, " ", "", -1)
        // split input
        splittedInput := splitToOperands(input)
        // get polish expression
        polishExpression := convertToPolishSystem(splittedInput)
        // calculate
        return calc.countPolishSystem(polishExpression), nil</span>
}

// split string to []string with needed math operands and actions
func splitToOperands(input string) (output []string) <span class="cov8" title="1">{
        for i := 0; i &lt; len(input); </span><span class="cov8" title="1">{
                sign, increment := getNextOperand(input, i)
                output = append(output, sign)
                i += increment
        }</span>

        <span class="cov8" title="1">return output</span>
}

// get next operand or action from input with the position
func getNextOperand(input string, position int) (output string, increment int) <span class="cov8" title="1">{
        sign := input[position]

        // if sign is action
        if strings.ContainsAny("()+-/*", string(sign)) </span><span class="cov8" title="1">{
                output = output + string(sign)
                increment++
                return output, increment
        }</span>

        // if sign is number
        <span class="cov8" title="1">for i := position; i &lt; len(input) &amp;&amp; !strings.ContainsAny("()+-/*", string(input[i])); i++ </span><span class="cov8" title="1">{
                if input[i] == ',' </span><span class="cov8" title="1">{
                        output += string('.')
                        continue</span>
                }

                <span class="cov8" title="1">output += string(input[i])</span>
        }

        <span class="cov8" title="1">return output, len(output)</span>
}

func reverseSlice(input []string) []string <span class="cov8" title="1">{
        for left, right := 0, len(input)-1; left &lt; right; left, right = left+1, right-1 </span><span class="cov8" title="1">{
                input[left], input[right] = input[right], input[left]
        }</span>
        <span class="cov8" title="1">return input</span>
}

// converting to polish system func
func convertToPolishSystem(input []string) (output []string) <span class="cov8" title="1">{
        // stack for math operators
        operatorStack := make([]string, 0)

        // priorities of math operators
        var priority = map[string]int{"*": 2, "/": 2, "-": 1, "+": 1, "(": 0, ")": 0}

        // get every part of input and analyze it
        for i := 0; i &lt; len(input); i++ </span><span class="cov8" title="1">{
                sign := input[i]
                if strings.ContainsAny("+-*/", sign) </span><span class="cov8" title="1">{
                        // drop signs to output until operator with smaller be on the top of stack
                        j := len(operatorStack) - 1
                        for ; j &gt;= 0 &amp;&amp; (priority[operatorStack[j]] &gt;= priority[sign]); j-- </span><span class="cov8" title="1">{
                                var dropSign string
                                operatorStack, dropSign = operatorStack[:len(operatorStack)-1], operatorStack[len(operatorStack)-1]
                                output = append(output, dropSign)
                        }</span>
                        // add operand to stack
                        <span class="cov8" title="1">operatorStack = append(operatorStack, sign)</span>
                } else<span class="cov8" title="1"> if string(sign) == "(" </span><span class="cov8" title="1">{
                        operatorStack = append(operatorStack, sign)
                }</span> else<span class="cov8" title="1"> if string(sign) == ")" </span><span class="cov8" title="1">{
                        j := len(operatorStack) - 1
                        // drop signs until (
                        for ; j &gt;= 0 &amp;&amp; operatorStack[j] != "("; j-- </span><span class="cov8" title="1">{
                                var dropSign string
                                operatorStack, dropSign = operatorStack[:len(operatorStack)-1], operatorStack[len(operatorStack)-1]
                                output = append(output, dropSign)
                        }</span>

                        <span class="cov8" title="1">if len(operatorStack) == 0 </span><span class="cov8" title="1">{
                                panic("Parsing expression error")</span>
                        } else<span class="cov8" title="1"> {
                                operatorStack = operatorStack[:len(operatorStack)-1]
                        }</span>
                } else<span class="cov8" title="1"> {
                        output = append(output, sign)
                }</span>
        }
        // add other operators in output
        <span class="cov8" title="1">operatorStack = reverseSlice(operatorStack)
        output = append(output, operatorStack...)

        return output</span>
}

// counting func
func (calc *Calc) countPolishSystem(input []string) (result float64) <span class="cov8" title="1">{
        numberStack := make([]float64, 0)

        for i := 0; i &lt; len(input); i++ </span><span class="cov8" title="1">{
                sign := input[i]

                if strings.ContainsAny("+-/*", sign) </span><span class="cov8" title="1">{
                        var val float64
                        // pop number in val and update stack
                        numberStack, val = numberStack[:len(numberStack)-1], numberStack[len(numberStack)-1]
                        // analyze sign
                        switch sign </span>{
                        case "+":<span class="cov8" title="1">
                                if len(numberStack) == 0 </span><span class="cov8" title="1">{
                                        numberStack = append(numberStack, val)
                                        continue</span>
                                }

                                <span class="cov8" title="1">numberStack[len(numberStack)-1] += val</span>
                        case "-":<span class="cov8" title="1">
                                if len(numberStack) == 0 </span><span class="cov8" title="1">{
                                        numberStack = append(numberStack, -val)
                                        continue</span>
                                }

                                <span class="cov8" title="1">numberStack[len(numberStack)-1] -= val</span>
                        case "*":<span class="cov8" title="1">
                                if len(numberStack) == 0 </span><span class="cov8" title="1">{
                                        panic("Parsing expression error")</span>
                                }

                                <span class="cov8" title="1">numberStack[len(numberStack)-1] *= val</span>
                        case "/":<span class="cov8" title="1">
                                if len(numberStack) == 0 </span><span class="cov8" title="1">{
                                        panic("Parsing expression error")</span>
                                }

                                <span class="cov8" title="1">if val == 0 </span><span class="cov8" title="1">{
                                        panic("Zero division")</span>
                                }
                                <span class="cov8" title="1">numberStack[len(numberStack)-1] = numberStack[len(numberStack)-1] / val</span>
                        }
                } else<span class="cov8" title="1"> {
                        // it is number -&gt; add in number stack
                        if s, err := strconv.ParseFloat(sign, 64); err == nil </span><span class="cov8" title="1">{
                                numberStack = append(numberStack, s)
                        }</span> else<span class="cov8" title="1"> {
                                panic("Parsing expression error")</span>
                        }
                }
        }
        // result will be in first cell
        <span class="cov8" title="1">result = numberStack[0]
        return result</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
